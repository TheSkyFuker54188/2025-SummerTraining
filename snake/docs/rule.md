# 规则与算法说明

## 游戏规则

### 一、游戏概述
本平台是一个多人在线对战的贪吃蛇游戏。玩家需编写算法程序，通过接口控制蛇的移动与行为，与其他玩家的程序进行博弈。游戏的核心目标是在有限的回合内，通过获取食物来最大化得分，同时规避各类风险。游戏结束时，得分最高的玩家获胜。

### 二、游戏地图
- 地图尺寸：40 × 30 格 (宽 × 高)
- 坐标系统：以左上角的格子为(0, 0)，x轴向右递增，y轴向下递增。

### 三、游戏实体
#### 1. 蛇
- 初始长度：5格  
- 移动方式：每个游戏刻 (tick) 移动一格。蛇由头部和身体组成，身体会跟随头部已走过的路径移动。

#### 2. 场上物品
- **普通食物**：提供1-5分，不同分值的食物颜色不同。  
- **增长豆**：使蛇的长度增加两格，不提供分数，其值为 `-1`。  
- **陷阱**：吃到后扣除10分，其值为 `-2`。  

### 四、游戏机制
#### 1. 蛇的成长
- **分数增长**：蛇的得分每累计达到20的倍数，长度会自动增加一格。  
- **直接增长**：吃到增长豆会使长度立即增加两格。  

#### 2. 护盾系统
- 蛇在出生时自带一个持续10个游戏刻的初始护盾。  
- 玩家可以消耗20分主动激活护盾。激活护盾是一个决策动作，该游戏刻蛇将 **停留在原地**。  
- 护盾激活后持续5个游戏刻，在此期间蛇免疫因碰撞导致的死亡（墙壁除外）。  
- 主动激活的护盾有30个游戏刻的冷却时间。  

#### 3. 碰撞规则
- **与障碍物碰撞**：蛇立即死亡。**此规则优先级最高，护盾无效**  
- **与自己的身体碰撞**：无影响，不会死亡  
- **与其他蛇身体碰撞**：  
  - 持有护盾：免疫碰撞，可安全穿过对方蛇的身体  
  - 未持有护盾：碰撞方立即死亡  
- **蛇头与蛇头碰撞**：  
  - 双方均有护盾：双方均不受伤害  
  - 仅一方有护盾：未持有护盾的一方死亡  
  - 双方均无护盾：双方同时死亡  

#### 4. 食物生成
- 游戏开始时会生成一批初始食物，之后每3个游戏刻会周期性生成新食物。  
- **生命周期**：  
  - 普通食物：60个游戏刻  
  - 增长豆/陷阱：80个游戏刻  
- **数量限制**：场上同时存在的食物总数上限与当前存活的蛇的数量正相关。达到上限后，将暂停自然生成食物。  
- **死亡转化**：蛇死亡后，其身体所在的位置会根据其分数转化为新的食物（每份食物价值最高为20分，直至分数耗尽）。  

#### 5. 宝箱机制
- **宝箱**：  
  - 仅在游戏中期和后期刷新，每局游戏最多出现两个。  
  - 分数计算公式：`基础分 + (第一名分数 - 非第一名平均分) * 0.6`，分数范围30-75。  
  - 对未持有钥匙的蛇是 **致命障碍物**，触碰即死，护盾无效。  

- **钥匙**：  
  - 与宝箱同步刷新，数量为 `max(2, floor(存活蛇数 / 2))`，上限为4。  
  - 拾取方式：蛇头触碰地上的钥匙。  
  - **掉落规则**：  
    - 持有者死亡时，钥匙掉落在头部位置。  
    - 连续持有超过30个游戏刻会自动脱落。  

- **交互规则**：蛇头必须在 **持有钥匙** 的状态下触碰宝箱，才能成功开启并获得其分数。宝箱被开启后，所有其他钥匙消失。  

#### 6. 安全区机制
安全区是游戏的核心活动区域。  
- 蛇的 **头部** 一旦处于安全区之外，立即死亡（身体部分可暂时在区外）。  
- 开启护盾可暂时免疫，但护盾结束后若仍在区外则死亡。  
- 食物仅在安全区内生成，安全区收缩时区外的食物会立即消失。  
- 安全区随游戏阶段向中心收缩。  

| 游戏阶段 | 游戏刻范围 | 收缩事件 | 最终尺寸 | 最终边界 `(x_min,y_min) -> (x_max,y_max)` |
|----------|------------|----------|----------|------------------------------------------|
| 早期     | 1 - 80     | 稳定     | 40 × 30  | (0,0) -> (39,29)                         |
| 中期     | 81 - 100   | 第一次收缩 | 34 × 26 | (3,2) -> (36,27)                         |
| 中期     | 161 - 180  | 第二次收缩 | 26 × 20 | (7,5) -> (32,24)                         |
| 后期     | 221 - 240  | 最终收缩 | 20 × 16 | (10,7) -> (29,22)                         |
| 后期     | 241 - 256  | 最终形态 | 20 × 16 | (10,7) -> (29,22)                         |

#### 7. 游戏阶段
- **早期阶段** (1 - 80)  
  - 食物：普通食物(1-3分) 80%，增长豆 20%。  
- **中期阶段** (81 - 200)  
  - 食物：普通食物(1-5分) 78%，增长豆 12%，陷阱 10%。  
  - 刷新第一个宝箱。  
- **后期阶段** (201 - 256)  
  - 食物：普通食物(1-5分) 80%，增长豆 5%，陷阱 15%。  
  - 可能刷新第二个宝箱。  

### 五、游戏结束条件
- 达到256个游戏刻上限  
- 场上已无任何蛇存活  
